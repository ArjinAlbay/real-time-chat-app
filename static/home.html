<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }
      #chat-container,
      #login-container {
        width: 100%;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        border: 1px solid #ccc;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      #chat-container {
        height: 80%;
      }
      #chat-header,
      #login-header {
        padding: 10px;
        background-color: #007bff;
        color: white;
        text-align: center;
      }
      #chat,
      #login {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
      }
      #chat p {
        margin: 5px 0;
      }
      #message-form {
        display: flex;
        padding: 10px;
      }
      #message-input,
      #username-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 10px;
      }
      #message-form button,
      #login-form button {
        padding: 10px 20px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
      }
      #message-form button:hover,
      #login-form button:hover {
        background-color: #0056b3;
      }
      #error {
        color: red;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="login-container">
      <div id="login-header">
        <h2>Login</h2>
      </div>
      <form id="login-form">
        <input
          id="username-input"
          type="text"
          placeholder="Enter your username"
          autocomplete="off"
        />
        <button type="submit">Login</button>
      </form>
      <p id="error"></p>
    </div>

    <div id="chat-container" style="display: none">
      <div id="chat-header">
        <h2>Chat App</h2>
      </div>
      <div id="chat"></div>
      <form id="message-form">
        <input
          id="message-input"
          type="text"
          placeholder="Type a message..."
          autocomplete="off"
        />
        <button type="submit">Send</button>
      </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const errorElement = document.getElementById("error");

      // Handle login form submission
      document.getElementById("login-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const username = document.getElementById("username-input").value;
        if (username) {
          socket.emit("setUsername", username);
        } else {
          errorElement.textContent = "Username cannot be empty";
        }
      });

      socket.on("usernameError", (error) => {
        errorElement.textContent = error;
      });

      socket.on("usernameSuccess", (message) => {
        errorElement.textContent = "";
        document.getElementById("login-container").style.display = "none";
        document.getElementById("chat-container").style.display = "flex";
        console.log(message);
      });

      // Handle message form submission
      document
        .getElementById("message-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const msg = document.getElementById("message-input").value;
          if (msg.trim()) {
            socket.emit("chat message", msg);
            document.getElementById("message-input").value = "";
          } else {
            errorElement.textContent = "Message cannot be empty";
          }
        });

      // Listen for messages from the server
      socket.on("chat message", (data) => {
        const chatDiv = document.getElementById("chat");
        const messageElement = document.createElement("p");
        messageElement.textContent = `${data.username}: ${data.message}`;
        chatDiv.appendChild(messageElement);
        chatDiv.scrollTop = chatDiv.scrollHeight;
      });

      socket.on("messageError", (error) => {
        errorElement.textContent = error;
      });

      socket.on("connect", () => {
        console.log("Connected to server");
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from server");
      });
    </script>
  </body>
</html>
